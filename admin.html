<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel - View Chats</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    #chat { border: 1px solid #ccc; height: 500px; overflow-y: scroll; padding: 10px; background: #f9f9f9; }
    .msg { margin-bottom: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; position: relative; }
    .user { font-weight: bold; }
    .time { font-size: 12px; color: #777; display: block; margin-top: 5px; }
    .status { font-size: 12px; color: green; margin-left: 10px; }
    .delete { position: absolute; top: 5px; right: 5px; background: red; color: white; border: none; padding: 3px 6px; border-radius: 3px; cursor: pointer; }
  </style>
</head>
<body>
  <h2>üõ°Ô∏è Admin Panel - Chat Monitor</h2>
  <div id="chat"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCBP-uiChoUl6DExnwc9xvrCMj9Sbj72sg",
      authDomain: "chat-ee464.firebaseapp.com",
      databaseURL: "https://chat-ee464-default-rtdb.firebaseio.com",
      projectId: "chat-ee464",
      storageBucket: "chat-ee464.firebasestorage.app",
      messagingSenderId: "967011465942",
      appId: "1:967011465942:web:83b030b334275afc4c6777"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const chatBox = document.getElementById("chat");

    // Load messages with key
    db.ref("messages").on("child_added", (snapshot) => {
      const key = snapshot.key;
      const msg = snapshot.val();

      const div = document.createElement("div");
      div.classList.add("msg");
      div.id = key;
      div.innerHTML = `
        <span class="user">${msg.user}</span>: 
        <span class="text">${msg.text}</span>
        <span class="status">${msg.seen ? '‚úÖ Seen' : '‚è≥ Unseen'}</span>
        <span class="time">${new Date(msg.time).toLocaleString()}</span>
        <button class="delete" onclick="deleteMessage('${key}')">Delete</button>
      `;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    });

    // Seen status change listener (optional real-time)
    db.ref("messages").on("child_changed", (snapshot) => {
      const key = snapshot.key;
      const msg = snapshot.val();
      const div = document.getElementById(key);
      if (div) {
        const status = div.querySelector(".status");
        if (status) status.textContent = msg.seen ? '‚úÖ Seen' : '‚è≥ Unseen';
      }
    });

    function deleteMessage(key) {
      if (confirm("Are you sure you want to delete this message?")) {
        db.ref("messages").child(key).remove();
        document.getElementById(key)?.remove();
      }
    }
  </script>
</body>
</html>
